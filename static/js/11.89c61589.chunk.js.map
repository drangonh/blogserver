{"version":3,"sources":["utils/oss.js","page/home/UpdateUserInfo.js","axios/index.js","static/image/defualt.jpeg"],"names":["uploadImage","data","file","func","err","type","a","get","res","client","OSS","region","endpoint","accessKeyId","accessKeySecret","bucket","bucketName","PhotoPath","put","result","UpdateUserInfo","inject","observer","props","addImage","input","click","handleImageChange","e","target","files","name","setState","photo","url","upload","person","header","params","avatar","state","email","nickName","description","uid","post","value","changeInfo","history","push","localStorage","setItem","JSON","stringify","login","this","id","className","onClick","style","display","ref","el","accept","onChange","src","length","require","placeholder","v","info","React","Component","Promise","resolve","reject","axios","then","catch","defaults","baseURL","withCredentials","timeout","headers","interceptors","request","use","config","error","response","status","module","exports"],"mappings":"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","file":"static/js/11.89c61589.chunk.js","sourcesContent":["/**\n * @author dragonH\n * @date 2020/5/23 0023 上午 11:35\n */\nimport OSS from \"ali-oss\"\nimport {get} from \"../axios\";\n\n/*方法说明\n *@method 方法名\n *@for 所属类名\n *@param{Blob、Buffer}data 支持File对象、Blob数据、以及OSS Buffer。\n * // or const data = new Blob('content');// or const data = new OSS.Buffer('content'));\n *@param{string} file 可以自定义为文件名（例如file.txt）或目录（例如abc/test/file.txt）的形式，\n * 实现将文件上传至当前Bucket或Bucket下的指定目录。实现将文件上传至当前Bucket或Bucket下的指定目录。\n *@return {返回值类型} 返回值说明\n*/\nexport async function uploadImage(data, file, func, err, type) {\n    let client\n\n    let res = await get(\"oss/ossInfo\", {})\n    if (res && res.data) {\n        const data = res.data;\n        client = new OSS({\n            region: data.endpoint,\n            accessKeyId: data.accessKeyId,\n            accessKeySecret: data.accessKeySecret,\n            bucket: data.bucketName\n        });\n    }\n\n    let PhotoPath = \"photo/\"\n\n    if (type == 2) {\n        PhotoPath = \"language/\"\n    } else if (type == 3) {\n        PhotoPath = \"article/\"\n    }\n    // 支持File对象、Blob数据、以及OSS Buffer。\n    // or const data = new Blob('content');\n    // or const data = new OSS.Buffer('content'));\n\n    try {\n        let result = await client.put(PhotoPath + file, data);\n        console.log(\"成功\", result)\n        func(result);\n    } catch (e) {\n        console.log(\"失败\", e)\n        err(e);\n    }\n}\n\n","import React from 'react';\nimport \"./UpdateUserInfo.scss\"\nimport {post, get} from \"../../axios\"\nimport {inject, observer} from \"mobx-react\";\nimport {uploadImage} from \"../../utils/oss\";\n\n// 观察者\n@inject('header')\n@observer\nclass UpdateUserInfo extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            login: true,//为true时代表登录，否则为注册\n            photo: \"\",\n            email: '',\n            nickName: \"\",\n            description: \"\"\n        }\n    }\n\n    componentDidMount() {\n\n        const {header: {person}} = this.props;\n\n        if (person) {\n            this.setState({\n                photo: person.avatar,\n                email: person.email,\n                nickName: person.nickName,\n                description: person.description\n            })\n        }\n\n    }\n\n    addImage = () => {\n        this.input.click();//触发input：file的click事件，\n    };\n\n    handleImageChange = async (e) => {//处理图片\n        const file = e.target.files[0];\n\n        uploadImage(file, file.name, (res) => {\n            console.log(res)\n            this.setState({\n                photo: res.url\n            })\n        })\n    };\n\n    upload = async () => {\n        const {header: {person}} = this.props;\n        const params = {\n            avatar: this.state.photo,\n            email: this.state.email,\n            nickName: this.state.nickName,\n            description: this.state.description,\n            uid: person && person.uid\n        }\n        console.log(params)\n        const res = await post(\"/profile/editUserProfile\", params)\n\n        console.log(res)\n        if (res.data) {\n            const {header} = this.props;\n\n            //清除input值\n            this.email.value = \"\"\n\n            header.changeInfo(res.data);\n            this.props.history.push(\"/home\");\n            localStorage.setItem(\"userInfo\", JSON.stringify(res.data))\n        }\n    }\n\n    render() {\n        const {photo} = this.state;\n        return (\n            <div id={\"updateInfo\"}>\n                <div className={\"box_6747X3\"}>\n\n                    <p className={\"text_6746X3\"}>\n                        请填写基本信息\n                    </p>\n\n                    <div onClick={this.addImage}>\n                        <input\n                            style={{\n                                display: 'none'\n                            }}\n                            ref={(el) => {\n                                this.input = el\n                            }}\n                            type='file'\n                            accept='image/*'\n                            onChange={this.handleImageChange}\n                        />\n\n                        <img\n                            className={\"default\"}\n                            src={photo.length != 0 ?\n                                photo\n                                : require(\"../../static/image/defualt.jpeg\")\n                            }\n                        />\n                    </div>\n\n                    <div className={\"text_12X1\"}>\n                        <input\n                            placeholder={\"请输入昵称\"}\n                            type={\"text\"}\n                            className={\"editValue\"}\n                            ref={v => this.nickName = v}\n                            value={this.state.nickName}\n                            onChange={(e) => {\n                                this.setState({\n                                    nickName: e.target.value\n                                })\n                            }}\n                        />\n                    </div>\n\n                    <div className={\"text_12X1\"}>\n                        <input\n                            placeholder={\"请输入邮箱\"}\n                            type={\"text\"}\n                            className={\"editValue\"}\n                            ref={v => this.email = v}\n                            value={this.state.email}\n                            onChange={(e) => {\n                                this.setState({\n                                    email: e.target.value\n                                })\n                            }}\n                        />\n                    </div>\n\n                    <div className={\"text_12X2\"}>\n                        <textarea\n                            placeholder={\"请输入个人介绍\"}\n                            type={\"text\"}\n                            className={\"editValue\"}\n                            ref={v => this.info = v}\n                            value={this.state.description}\n                            onChange={(e) => {\n                                this.setState({\n                                    description: e.target.value\n                                })\n                            }}\n                        />\n                    </div>\n\n                    <div\n                        onClick={this.upload}\n                        className={\"text_18X1 uac_jc\"}>\n                        完 成\n                    </div>\n                </div>\n\n            </div>\n        )\n    }\n}\n\n\nexport default UpdateUserInfo\n","/**axios封装\n * 请求拦截、相应拦截、错误统一处理\n */\nimport axios from 'axios';\nimport QS from 'qs';\n// import {Toast} from 'vant';\n// import store from '../store/index'\n\nconst development = \"http://127.0.0.1:8888/blog/\";\nconst production = \"https://www.dontheway.com:8880/blog/\";\n\n// 环境的切换\nif (process.env.NODE_ENV == 'development') {\n    axios.defaults.baseURL = development;\n} else if (process.env.NODE_ENV == 'debug') {\n    axios.defaults.baseURL = '';\n} else if (process.env.NODE_ENV == 'production') {\n    axios.defaults.baseURL = production;\n}\n\n// 允许携带cookie，跨域设置。跨域的时候会造成无法携带cookie，这时需要允许跨域。同时后端也要进行配置\naxios.defaults.withCredentials = true;\n\n// 请求超时时间\naxios.defaults.timeout = 10000;\n\n// 请求头设置，post请求的时候必须设置'Content-Type': 'application/x-www-form-urlencoded'\n//以下两种写法都可以\naxios.defaults.headers = {\n    'Content-Type': 'application/x-www-form-urlencoded'\n};\n\n// post请求头\n// axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=UTF-8';\n\n// 请求拦截器\naxios.interceptors.request.use(\n    config => {\n        // 每次发送请求之前判断是否存在token，如果存在，则统一在http请求的header都加上token，不用每次请求都手动添加了\n        // 即使本地存在token，也有可能token是过期的，所以在响应拦截器中要对返回状态进行判断\n        // const token = store.state.token;\n        const token = \"\";\n        token && (config.headers.Authorization = token);\n        return config;\n    },\n    error => {\n        return Promise.error(error);\n    })\n\n// 响应拦截器\naxios.interceptors.response.use(\n    response => {\n        if (response.status === 200) {\n            return Promise.resolve(response);\n        } else {\n            return Promise.reject(response);\n        }\n    },\n    // 服务器状态码不是200的情况\n    error => {\n        if (error.response.status) {\n            switch (error.response.status) {\n                // 401: 未登录\n                // 未登录则跳转登录页面，并携带当前页面的路径\n                // 在登录成功后返回当前页面，这一步需要在登录页操作。\n                case 401:\n\n                    // router.replace({\n                    //     path: '/login',\n                    //     query: {redirect: router.currentRoute.fullPath}\n                    // });\n                    break;\n                // 403 token过期\n                // 登录过期对用户进行提示\n                // 清除本地token和清空vuex中token对象\n                // 跳转登录页面\n                case 403:\n                    // Toast({\n                    //     message: '登录过期，请重新登录',\n                    //     duration: 1000,\n                    //     forbidClick: true\n                    // });\n                    // // 清除token\n                    // localStorage.removeItem('token');\n                    // store.commit('loginSuccess', null);\n                    // // 跳转登录页面，并将要浏览的页面fullPath传过去，登录成功后跳转需要访问的页面\n                    // setTimeout(() => {\n                    //     router.replace({\n                    //         path: '/login',\n                    //         query: {\n                    //             redirect: router.currentRoute.fullPath\n                    //         }\n                    //     });\n                    // }, 1000);\n                    break;\n                // 404请求不存在\n                case 404:\n                    // Toast({\n                    //     message: '网络请求不存在',\n                    //     duration: 1500,\n                    //     forbidClick: true\n                    // });\n                    break;\n                // 其他错误，直接抛出错误提示\n                default:\n                // Toast({\n                //     message: error.response.data.message,\n                //     duration: 1500,\n                //     forbidClick: true\n                // });\n            }\n            return Promise.reject(error.response);\n        }\n    }\n);\n\n/**\n * get方法，对应get请求\n * @param {String} url [请求的url地址]\n * @param {Object} params [请求时携带的参数]\n */\nexport function get(url, params) {\n    return new Promise((resolve, reject) => {\n        axios.get(url, {\n            params: params,\n        })\n            .then(res => {\n                console.log(\"请求参数\", params);\n                console.log(\"请求地址\", url);\n                console.log(\"请求结果\", res);\n                resolve(res.data);\n            })\n            .catch(err => {\n                console.log(\"请求错误\", err);\n                reject(err.data)\n            })\n    });\n}\n\n/**\n * post方法，对应post请求\n * @param {String} url [请求的url地址]\n * @param {Object} params [请求时携带的参数]\n */\nexport function post(url, params) {\n    return new Promise((resolve, reject) => {\n        //axios的默认Content-Type是 application/json;charset=utf-8\n        //params= QS.stringify(params);   这会让参数拼接在URL后面\n        //如果后端参数是body中拿到的，那么需要设置Content-Type': 'application/x-www-form-urlencoded'\n        axios.post(url, params)\n            .then(res => {\n                console.log(\"请求参数\", params);\n                console.log(\"请求地址\", url);\n                console.log(\"请求结果\", res);\n                resolve(res.data);\n            })\n            .catch(err => {\n                console.log(\"请求错误\", err);\n                reject(err.data)\n            })\n    });\n}\n","module.exports = __webpack_public_path__ + \"static/media/defualt.8e05f6fe.jpeg\";"],"sourceRoot":""}